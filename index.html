<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale= 1.0">
        <title>Presentasjon</title>
        <style>
            body {
                /* background-color: rgb(238, 206, 168); */
                margin: 0;
                display: grid;
                grid-template-areas: 
                    "header header "
                    "nav tabell"
                    "nav iframe";
                grid-template-rows: 70px auto;
                grid-template-columns: 200px auto;
                gap: 20px;
                height: 99vh;
            }

            h1 {
                grid-area: header;
                display: flex;
                justify-content: center;
            }

            .knapp {
                width: 100%;
                margin-bottom: 10px;
            }

            #knapper {
                grid-area: nav;
            }

            #iframe {
                margin: 10px;
                grid-area: iframe;
                width: 96%;
                height: 98%;
            }

            #Tabell {
                margin: 10px;
                grid-area: tabell;
                width: 96%;
                border-collapse: collapse;
            }

            table, th, td {
                border: 1px solid black;
                text-align: center;
                padding: 8px;
            }

        </style>
    </head>
    <body>
        <h1>Datapresentasjon</h1>
        <ul id="knapper">
            <li><button name="Pris_Volum" onclick="Klikk('/pris_volum')" class="knapp">Pris/Volum</button></li>
            <li><button name="Ansatte" onclick="Klikk('/ansatte')" class="knapp">Ansatte</button></li>
            <li><button name="Salg per måned" onclick="Klikk('/maned_salg')" class="knapp">Måned salg</button></li>
            <li><button name="Sesong_trend" onclick="Klikk('/sesong_trend')" class="knapp">Sesong trend</button></li>
            <li><button name="Leveringstid" onclick="Klikk('/leveringstid')" class="knapp">Leveringstid</button></li>
            <li><button name="Snitt verdi" onclick="Klikk('/snitt_verdi')" class="knapp">Snitt verdi</button></li>
            <li><button name="Etterspørsel" onclick="Klikk('/ettersporsel')" class="knapp">Etterspørsel</button></li>
            <li><button name="Kategorier" onclick="Klikk('/kategorier')" class="knapp">Kategorier</button></li>
            <li><button name="Lagerbeholdning" onclick="Klikk('/lagerbeholdning')" class="knapp">Lagerbeholdning</button></li>
            <li><button name="Leverandør" onclick="Klikk('/leverandor')" class="knapp">Leverandør</button></li>
            <li><button name="Salg" onclick="Klikk('/salg')" class="knapp">Salg</button></li>
            <li><button name="Varer" onclick="Klikk('/varer')" class="knapp">Varer</button></li>
        </ul>
        <table id="Tabell">
            <!-- Dynamisk tabell -->
        </table>
        <iframe name="Datasett" id="iframe" src="/ansatte"></iframe>
        <script>

            const urlBase = window.location.origin;

            function changeIframe(url){
                const iframe = document.getElementById("iframe");
                iframe.src = urlBase + url;
            };

            async function fetchData(url){

                const tabell = document.getElementById("Tabell");

                //slette alt i tabellen
                tabell.innerHTML = "";

                try{

                    //hente data
                    const response = await fetch(urlBase + url);
                    if (!response.ok) {
                        throw new Error("server error: " + response.status);
                    };

                    const data = await response.json();

                    //bruke keys som kolonner
                    const columnNames = Object.keys(data[0]);

                    // tr = table row
                    const headerRow = document.createElement("tr");

                    columnNames.forEach(column => {

                        // th = table header
                        const tabellHeader = document.createElement("th");

                        tabellHeader.innerText = column;
                        headerRow.appendChild(tabellHeader);

                    });

                    tabell.appendChild(headerRow);

                    // lage rader av dataen
                    data.forEach(item => {

                        const rad = document.createElement("tr");
                        
                        columnNames.forEach(column => {
                            // td = table data
                            const tabellData = document.createElement("td")

                            tabellData.innerText = item[column] || "";
                            rad.appendChild(tabellData);

                        });

                        tabell.appendChild(rad);

                    })

                }catch (error){

                    console.error("Error fetching data:", error);

                };

            };

            async function Klikk(url){
                fetchData(url);
                changeIframe(url);
            };


        </script>
    </body>
</html>