<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale= 1.0">
        <title>Presentasjon</title>
        <style>
            body {
                /* background-color: rgb(238, 206, 168); */
                margin: 0px;
                display: grid;
                grid-template-areas: 
                    "header header "
                    "nav nav"
                    "desc desc"
                    "param param"
                    "tabell tabell"
                    "iframe iframe";
                grid-template-rows: 70px auto;
                grid-template-columns: 200px auto;
                gap: 20px;
                height: auto;
            }

            h1 {
                grid-area: header;
                display: flex;
                justify-content: center;
            }

            .nav-header{
                grid-area: nav;
                overflow: scroll;
                overflow-x: auto;
                overflow-y: hidden;
                scroll-snap-type: x mandatory;
                background-color: lightslategray;
            }

            li {
                float: left;
                display: block;
            }

            article {
                grid-area: desc;
                margin-left: 30px;
            }

            .knapp {
                /* width: 100%; */
                margin-right: 20px;
                /* float: left; */
            }

            #knapper {
                display: flex;
                list-style: none;
                white-space: nowrap;
            }

            #iframe {
                margin: 10px;
                grid-area: iframe;
                width: 97%;
                height: 98%;
                min-height: 400px;
            }

            #Tabell {
                margin: 10px;
                grid-area: tabell;
                width: 97%;
                border-collapse: collapse;
            }

            table, th, td {
                border: 1px solid black;
                text-align: center;
                padding: 8px;
            }

            #filterParam {
                margin-left: 10px;
                margin-right: 10px;
                grid-area: param;
            }

        </style>
    </head>
    <body>
        <h1>Datapresentasjon</h1>
        <nav class="nav-header">
            <ul id="knapper">
                <li><button type="button" name="Pris_Volum" onclick="Klikk('/pris_volum', `her ser vi om det er ett forhold mellom volum og pris`)" class="knapp">Pris/Volum</button></li>
                <li><button type="button" name="Ansatte" onclick="Klikk('/ansatte', `her vises ansatte, sortert etter antall salg`)" class="knapp">Ansatte</button></li>
                <li><button type="button" name="Salg per måned" onclick="Klikk('/maned_salg', `totalt antall salg per måned`)" class="knapp">Måned salg</button></li>
                <li><button type="button" name="Sesong_trend" onclick="Klikk('/sesong_trend', `gjennomsnitt salg per kvartal, og per måned`)" class="knapp">Sesong trend</button></li>
                <li><button type="button" name="Leveringstid" onclick="Klikk('/leveringstid', `gjennomsnittlig leveringstid per fraktfirma`)" class="knapp">Leveringstid</button></li>
                <li><button type="button" name="Snitt verdi" onclick="Klikk('/snitt_verdi', `gjennomsnittlig innkjøpsverdi per kunde`)" class="knapp">Snitt verdi</button></li>
                <li><button type="button" name="Etterspørsel" onclick="Klikk('/ettersporsel', `produktetterspørsel per måned av hvert år`)" class="knapp">Etterspørsel</button></li>
                <li><button type="button" name="Kategorier" onclick="Klikk('/kategorier', `antall salg for hver varekategori`)" class="knapp">Kategorier</button></li>
                <li><button type="button" name="Lagerbeholdning" onclick="Klikk('/lagerbeholdning',`lagerbeholdning`)" class="knapp">Lagerbeholdning</button></li>
                <li><button type="button" name="Leverandør" onclick="Klikk('/leverandor', `antall varer solgt fra hver leverandør`)" class="knapp">Leverandør</button></li>
                <li><button type="button" name="Salg" onclick="Klikk('/salg', `Gjennomførte salg`)" class="knapp">Salg</button></li>
                <li><button type="button" name="Varer" onclick="Klikk('/varer', `Alle tilgjengelige varer`)" class="knapp">Varer</button></li>
            </ul>
        </nav>
        <article id="beskrivelse"></article>
        <input type="text" id="filterParam" placeholder="filtrer tabell..." onkeyup="filtrerTabell()">
        <!-- <form id="filterParam"></form> -->
        <table id="Tabell">
            <!-- Dynamisk tabell -->
        </table>
        <iframe title="Datasett" name="Datasett" id="iframe" src="/ansatte"></iframe>
        <script>

            document.addEventListener("DOMContentLoaded", () => {

                // velge navigerings-stripen, og få den til å scrolle sidelengs, når pekeren er over den
                const navHeader = document.querySelector(".nav-header");

                navHeader.addEventListener("wheel", function (event) {
                    
                    if(event.deltaY !== 0) {
                        event.preventDefault();
                        navHeader.scrollLeft += event.deltaY;
                    };

                });

            });


            // grunn-urlen til siden, for bruk i tabell-fetch og iframe
            const urlBase = window.location.origin;

            // endre hvilken data som vises i iframe
            function changeIframe(url){
                const iframe = document.getElementById("iframe");
                iframe.src = urlBase + url;
            };

            // endre hvilken data tabellen viser
            async function fetchData(url){

                // sende filtrerings-variabler til serveren, gjennom header
                // const header = new Headers()

                const tabell = document.getElementById("Tabell");

                //slette alt i tabellen
                tabell.innerHTML = "";

                try{

                    //hente data
                    const response = await fetch(urlBase + url);
                    
                    if (!response.ok) {

                        throw new Error("server error: " + response.status);
                    
                    };

                    const data = await response.json();

                    //bruke keys som kolonner
                    const columnNames = Object.keys(data[0]);

                    // tr = table row
                    const headerRow = document.createElement("tr");

                    columnNames.forEach(column => {

                        // th = table header
                        const tabellHeader = document.createElement("th");

                        tabellHeader.innerText = column;
                        headerRow.appendChild(tabellHeader);

                    });

                    tabell.appendChild(headerRow);

                    // lage rader av dataen
                    data.forEach(item => {

                        const rad = document.createElement("tr");
                        
                        columnNames.forEach(column => {

                            // td = table data
                            const tabellData = document.createElement("td")

                            tabellData.innerText = item[column] || "";
                            rad.appendChild(tabellData);

                        });

                        tabell.appendChild(rad);

                    });

                }catch (error){

                    console.error("Error fetching data:", error);

                };

            };

            // endre begge ved klikk
            async function Klikk(url, desc){

                // tømme søkefeltet, hver gang  man bytter innholdet i tabellen
                const param = document.getElementById("filterParam");
                param.value = "";

                const beskrivelse = document.getElementById("beskrivelse");
                beskrivelse.innerHTML = "";

                // lage <p> for beskrivelsen
                const besk = document.createElement("p");
                besk.textContent = desc;

                beskrivelse.appendChild(besk);

                fetchData(url);
                changeIframe(url);

            };

            function filtrerTabell(){

                // velge søkefeltet
                const input = document.getElementById("filterParam");
                const filter = input.value.toLowerCase();

                //velge tabellen, og radene i tabellen
                const table = document.getElementById("Tabell");
                const rows = table.getElementsByTagName("tr");

                // for hver rad i tabellen, untatt header
                for (let i = 1; i < rows.length; i++){
                    const cells = rows[i].getElementsByTagName("td");
                    let match = false;

                    // for hver celle i raden
                    for (let y = 0; y < cells.length; y++) {
                        if (cells[y].textContent.toLowerCase().includes(filter)){
                            match = true;
                            break;
                        };
                    };

                    // skjule/vise basert på om en rad i cellen matcher
                    rows[i].style.display = match ? "" : "none";
                };

            };

            // function AnsatteFilter () {
            //     const parametere = document.getElementById("filterParam");
                
            //     // lage inputfelt for fornavn
            //     const fornavnLabel = document.createElement("label");
            //     fornavnLabel.setAttribute("for", "fornavn");
            //     fornavnLabel.textContent = "Fornavn";

            //     const fornavnInput = document.createElement("input");
            //     fornavnInput.setAttribute("type", "text");
            //     fornavnInput.setAttribute("id", "fornavn");
            //     fornavnInput.setAttribute("name", "fornavn");
                
            //     // lage inputfelt for etternavn
            //     const etternavnLabel = document.createElement("label");
            //     etternavnLabel.setAttribute("for", "etternavn");
            //     etternavnLabel.textContent = "Etternavn";

            //     const etternavnInput = document.createElement("input");
            //     etternavnInput.setAttribute("type", "text");
            //     etternavnInput.setAttribute("id", "etternavn");
            //     etternavnInput.setAttribute("name", "etternavn");

            //     // feste til form
            //     parametere.appendChild(fornavnLabel);
            //     parametere.appendChild(fornavnInput);

            //     parametere.appendChild(etternavnLabel);
            //     parametere.appendChild(etternavnInput);

            //     const sendParam =  document.createElement("button");
            //     sendParam.setAttribute("name", "Filtrer");
            //     sendParam.setAttribute("type", "submit");
            //     sendParam.setAttribute("onclick", "submit()");
            //     sendParam.setAttribute("class", "knapp");
                
            //     parametere.appendChild(sendParam);

            // };


        </script>
    </body>
</html>